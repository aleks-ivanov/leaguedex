# Migration `20210119154452-add-champion-info-to-game-table`

This migration has been generated by Donny Roufs at 1/19/2021, 4:44:52 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "NotificationStatus" AS ENUM ('pending', 'accepted', 'declined');

CREATE TYPE "GameType" AS ENUM ('notification', 'manual');

CREATE TABLE "public"."User" (
"id" SERIAL,
"email" text  NOT NULL ,
"username" text  NOT NULL ,
"password" text  NOT NULL ,
"permissions" integer  NOT NULL DEFAULT 1,
"active" boolean  NOT NULL DEFAULT false,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Summoner" (
"id" SERIAL,
"accountId" text  NOT NULL ,
"summonerId" text   ,
"name" text  NOT NULL ,
"level" integer  NOT NULL ,
"region" text  NOT NULL DEFAULT E'euw',
"user_id" integer   ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Game" (
"user_id" integer  NOT NULL ,
"summoner_id" text  NOT NULL ,
"game_id" text  NOT NULL ,
"champion_id" integer  NOT NULL ,
"opponent_id" integer  NOT NULL ,
"region" text   ,
"lane" text   ,
"timestamp" timestamp(3)   ,
"type" "GameType" NOT NULL DEFAULT E'manual',
"status" "NotificationStatus" NOT NULL DEFAULT E'pending',
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
PRIMARY KEY ("user_id","game_id","summoner_id"))

CREATE TABLE "public"."Matchup" (
"id" SERIAL,
"games_played" integer  NOT NULL DEFAULT 0,
"games_won" integer   DEFAULT 0,
"games_lost" integer   DEFAULT 0,
"private" boolean  NOT NULL DEFAULT true,
"game_id" text   ,
"champion_id" integer  NOT NULL ,
"opponent_id" integer  NOT NULL ,
"lane" text  NOT NULL ,
"user_id" integer  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
PRIMARY KEY ("champion_id","opponent_id","lane","user_id"))

CREATE TABLE "public"."Note" (
"id" SERIAL,
"tags" text   ,
"content" text  NOT NULL ,
"champion_id" integer   ,
"matchup_id" integer  NOT NULL ,
"user_id" integer  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Champion" (
"id" integer  NOT NULL ,
"name" text  NOT NULL ,
"image" text  NOT NULL ,
"splash" text  NOT NULL ,
"icon" text  NOT NULL ,
"version" text  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Token" (
"id" SERIAL,
"token" text  NOT NULL ,
"user_id" integer  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."User_verification" (
"id" SERIAL,
"token" text  NOT NULL ,
"user_id" integer  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "public"."User_reset_password" (
"id" SERIAL,
"token" text  NOT NULL ,
"user_id" integer  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

CREATE UNIQUE INDEX "User.username_unique" ON "public"."User"("username")

CREATE UNIQUE INDEX "Matchup.id_unique" ON "public"."Matchup"("id")

CREATE UNIQUE INDEX "Champion.name_unique" ON "public"."Champion"("name")

CREATE UNIQUE INDEX "Token.user_id_unique" ON "public"."Token"("user_id")

CREATE UNIQUE INDEX "User_verification.token_unique" ON "public"."User_verification"("token")

CREATE UNIQUE INDEX "User_verification.user_id_unique" ON "public"."User_verification"("user_id")

CREATE UNIQUE INDEX "User_reset_password.token_unique" ON "public"."User_reset_password"("token")

CREATE UNIQUE INDEX "User_reset_password.user_id_unique" ON "public"."User_reset_password"("user_id")

ALTER TABLE "public"."Summoner" ADD FOREIGN KEY ("user_id")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Matchup" ADD FOREIGN KEY ("champion_id")REFERENCES "public"."Champion"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Matchup" ADD FOREIGN KEY ("opponent_id")REFERENCES "public"."Champion"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Matchup" ADD FOREIGN KEY ("user_id")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Note" ADD FOREIGN KEY ("matchup_id")REFERENCES "public"."Matchup"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Note" ADD FOREIGN KEY ("user_id")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Token" ADD FOREIGN KEY ("user_id")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."User_verification" ADD FOREIGN KEY ("user_id")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."User_reset_password" ADD FOREIGN KEY ("user_id")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20210118141126-add-games-table..20210119154452-add-champion-info-to-game-table
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model User {
   id                  Int                   @id @default(autoincrement())
@@ -40,8 +40,10 @@
 model Game {
   user_id     Int
   summoner_id String
   game_id     String
+  champion_id Int
+  opponent_id Int
   region      String?
   lane        String?
   timestamp   DateTime?
   type        GameType           @default(manual)
```


