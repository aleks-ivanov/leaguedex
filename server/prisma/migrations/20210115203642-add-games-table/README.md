# Migration `20210115203642-add-games-table`

This migration has been generated by Donny Roufs at 1/15/2021, 9:36:42 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "NotificationStatus" AS ENUM ('pending', 'accepted', 'declined');

CREATE TYPE "GameType" AS ENUM ('notification', 'manual');

CREATE TABLE "public"."User" (
"id" SERIAL,
"email" text  NOT NULL ,
"username" text  NOT NULL ,
"password" text  NOT NULL ,
"permissions" integer  NOT NULL DEFAULT 1,
"active" boolean  NOT NULL DEFAULT false,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Summoner" (
"id" SERIAL,
"accountId" text  NOT NULL ,
"summonerId" text   ,
"name" text  NOT NULL ,
"level" integer  NOT NULL ,
"region" text  NOT NULL DEFAULT E'euw',
"user_id" integer   ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Game" (
"user_id" integer  NOT NULL ,
"summoner_id" text  NOT NULL ,
"game_id" text  NOT NULL ,
"region" text   ,
"lane" text   ,
"timestamp" text   ,
"type" "GameType" NOT NULL DEFAULT E'manual',
"status" "NotificationStatus" NOT NULL DEFAULT E'pending',
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
PRIMARY KEY ("user_id","game_id","summoner_id"))

CREATE TABLE "public"."Matchup" (
"id" SERIAL,
"games_played" integer  NOT NULL DEFAULT 0,
"games_won" integer   DEFAULT 0,
"games_lost" integer   DEFAULT 0,
"private" boolean  NOT NULL DEFAULT true,
"game_id" text   ,
"champion_id" integer  NOT NULL ,
"opponent_id" integer  NOT NULL ,
"lane" text  NOT NULL ,
"user_id" integer  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
PRIMARY KEY ("champion_id","opponent_id","lane","user_id"))

CREATE TABLE "public"."Note" (
"id" SERIAL,
"tags" text   ,
"content" text  NOT NULL ,
"champion_id" integer   ,
"matchup_id" integer  NOT NULL ,
"user_id" integer  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Champion" (
"id" integer  NOT NULL ,
"name" text  NOT NULL ,
"image" text  NOT NULL ,
"splash" text  NOT NULL ,
"icon" text  NOT NULL ,
"version" text  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Token" (
"id" SERIAL,
"token" text  NOT NULL ,
"user_id" integer  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."User_verification" (
"id" SERIAL,
"token" text  NOT NULL ,
"user_id" integer  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "public"."User_reset_password" (
"id" SERIAL,
"token" text  NOT NULL ,
"user_id" integer  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

CREATE UNIQUE INDEX "User.username_unique" ON "public"."User"("username")

CREATE UNIQUE INDEX "Matchup.id_unique" ON "public"."Matchup"("id")

CREATE UNIQUE INDEX "Champion.name_unique" ON "public"."Champion"("name")

CREATE UNIQUE INDEX "Token.user_id_unique" ON "public"."Token"("user_id")

CREATE UNIQUE INDEX "User_verification.token_unique" ON "public"."User_verification"("token")

CREATE UNIQUE INDEX "User_verification.user_id_unique" ON "public"."User_verification"("user_id")

CREATE UNIQUE INDEX "User_reset_password.token_unique" ON "public"."User_reset_password"("token")

CREATE UNIQUE INDEX "User_reset_password.user_id_unique" ON "public"."User_reset_password"("user_id")

ALTER TABLE "public"."Summoner" ADD FOREIGN KEY ("user_id")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Matchup" ADD FOREIGN KEY ("champion_id")REFERENCES "public"."Champion"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Matchup" ADD FOREIGN KEY ("opponent_id")REFERENCES "public"."Champion"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Matchup" ADD FOREIGN KEY ("user_id")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Note" ADD FOREIGN KEY ("matchup_id")REFERENCES "public"."Matchup"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Note" ADD FOREIGN KEY ("user_id")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Token" ADD FOREIGN KEY ("user_id")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."User_verification" ADD FOREIGN KEY ("user_id")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."User_reset_password" ADD FOREIGN KEY ("user_id")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201119195852-user-can-have-many-summoners..20210115203642-add-games-table
--- datamodel.dml
+++ datamodel.dml
@@ -1,43 +1,57 @@
-// This is your Prisma schema file,
-// learn more about it in the docs: https://pris.ly/d/prisma-schema
+generator client {
+  provider = "prisma-client-js"
+}
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
-generator client {
-  provider = "prisma-client-js"
-  previewFeatures = ["transactionApi"]
+model User {
+  id                  Int                   @id @default(autoincrement())
+  email               String                @unique
+  username            String                @unique
+  password            String
+  permissions         Int                   @default(1)
+  summoner            Summoner[]
+  matchups            Matchup[]
+  Note                Note[]
+  token               Token?
+  user_verification   User_verification?
+  active              Boolean               @default(false)
+  createdAt           DateTime              @default(now())
+  updatedAt           DateTime              @updatedAt
+  User_reset_password User_reset_password[]
 }
-model User {
-  id                Int                @id @default(autoincrement())
-  email             String             @unique
-  username          String             @unique
-  password          String
-  permissions       Int                @default(1)
-  summoner          Summoner[]
-  matchups          Matchup[]
-  Note              Note[]
-  token             Token?
-  user_verification User_verification?
-  active            Boolean            @default(false)
-  createdAt         DateTime           @default(now())
-  updatedAt         DateTime           @updatedAt
+model Summoner {
+  id         Int      @id @default(autoincrement())
+  accountId  String // summonerId 
+  summonerId String? // accountId
+  name       String
+  level      Int
+  region     String   @default("euw")
+  user_id    Int?
+  user       User?    @relation(fields: [user_id], references: [id])
+  createdAt  DateTime @default(now())
+  updatedAt  DateTime @updatedAt
 }
-model Summoner {
-  id        Int      @id @default(autoincrement())
-  accountId String
-  name      String
-  level     Int
-  region    String   @default("euw")
-  user_id   Int?
-  user      User?    @relation(fields: [user_id], references: [id])
+model Game {
+  user_id     Int
+  summoner_id String
+  game_id     String
+  region      String?
+  lane        String?
+  timestamp   String?
+  type        GameType           @default(manual)
+  status      NotificationStatus @default(pending)
+
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
+
+  @@id([user_id, game_id, summoner_id])
 }
 model Matchup {
   id           Int      @unique @default(autoincrement())
@@ -110,4 +124,14 @@
   user      User     @relation(fields: [user_id], references: [id])
   createdAt DateTime @default(now())
 }
+enum NotificationStatus {
+  pending
+  accepted
+  declined
+}
+
+enum GameType {
+  notification
+  manual
+}
```


